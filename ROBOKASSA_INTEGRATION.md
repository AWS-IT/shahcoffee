# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Robokassa –ø–ª–∞—Ç–µ–∂–µ–π

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (`.env`)
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Robokassa:
  - `ROBOKASSA_MERCHANT_ID=CofeeShah`
  - `ROBOKASSA_PASS1=ZfoI2F5EcLxitlb6pQ19`
  - `ROBOKASSA_PASS2=W6APdxswwMX2e8qEVS35`

### 2. **–°–µ—Ä–≤–µ—Ä** (`server.js`)
–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–∞ –Ω–æ–≤—ã—Ö –µ–Ω–¥–ø–æ–∏–Ω—Ç–∞:

#### POST `/robokassa/init-payment`
–ò–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–ª–∞—Ç–µ–∂ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ Robokassa
```json
// –ó–∞–ø—Ä–æ—Å:
{
  "orderId": "unique_order_id",
  "amount": "1500.00",
  "description": "–ó–∞–∫–∞–∑ –∫–æ—Ñ–µ",
  "customerEmail": "customer@example.com"
}

// –û—Ç–≤–µ—Ç:
{
  "redirectUrl": "https://auth.robokassa.ru/Merchant/Index/...",
  "orderId": "...",
  "sum": 1500
}
```

#### POST `/robokassa/result`
Callback –æ—Ç Robokassa –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å MD5)

### 3. **–ù–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**

#### `/checkout` - CheckoutPage.jsx
- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, email, –∞–¥—Ä–µ—Å)
- –°–≤–æ–¥–∫–∞ –∑–∞–∫–∞–∑–∞ —Å –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º–æ–π
- –ö–Ω–æ–ø–∫–∞ "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ" ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Robokassa
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –≤ `localStorage` –ø–µ—Ä–µ–¥ –ø–ª–∞—Ç–µ–∂–æ–º

#### `/payment-result` - PaymentResultPage.jsx
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å Robokassa
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç–µ–∂–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ (—É—Å–ø–µ—à–Ω–æ / –æ—à–∏–±–∫–∞ / –æ–±—Ä–∞–±–æ—Ç–∫–∞)
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 4. **–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–ª–æ—É –∫–æ—Ä–∑–∏–Ω—ã**
- –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" —Ç–µ–ø–µ—Ä—å –≤–µ–¥–µ—Ç –Ω–∞ `/checkout`
- –í–º–µ—Å—Ç–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –≤ –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –ú–æ–π–°–∫–ª–∞–¥–∞

## üìã Flow –æ–ø–ª–∞—Ç—ã (—Å–µ–π—á–∞—Å)

```
1. –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ (/cart)
2. –ù–∞–∂–∞—Ç—å "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (/checkout)
4. –ù–∞–∂–∞—Ç—å "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
5. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Robokassa (–ø–ª–∞—Ç–µ–∂)
6. Robokassa –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–æ–±—Ä–∞–±–æ—Ç–∫–∞)
7. –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ /payment-result —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
```

## üîÑ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –≤ –ë–î** (–ø–µ—Ä–µ–¥ –ø–ª–∞—Ç–µ–∂–æ–º)
–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ë–î (MongoDB, PostgreSQL –∏–ª–∏ –¥—Ä—É–≥—É—é) –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–∞–∫–∞–∑ —Å —Å—Ç–∞—Ç—É—Å–æ–º `"pending"` (–æ–∂–∏–¥–∞—é—â–∏–π –æ–ø–ª–∞—Ç—ã):

```javascript
// –í CheckoutPage –ø–µ—Ä–µ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –Ω–∞ Robokassa:
const orderInDB = {
  orderId,
  status: "pending",
  customer: formData,
  items: cart,
  totalPrice,
  createdAt: new Date()
};
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ë–î
```

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≥—Ä—É–∑–∫–∏ –≤ –ú–æ–π–°–∫–ª–∞–¥** (–ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞)
–í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ `/robokassa/result` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```javascript
app.post('/robokassa/result', async (req, res) => {
  // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ ...
  
  // 1. –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑ –≤ –ë–î –ø–æ OrderId
  const order = await Order.findOne({ orderId: OrderId });
  
  // 2. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ "paid"
  order.status = "paid";
  await order.save();
  
  // 3. –°–æ–∑–¥–∞—Ç—å –æ—Ç–≥—Ä—É–∑–∫—É –≤ –ú–æ–π–°–∫–ª–∞–¥
  await createShipmentInMoySklad(order);
  
  res.json({ ok: true });
});

async function createShipmentInMoySklad(order) {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ú–æ–π–°–∫–ª–∞–¥ API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≥—Ä—É–∑–∫–∏
  // –ó–¥–µ—Å—å –≤–∞—à –∫–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≥—Ä—É–∑–∫–∏
}
```

### 3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Return URL –≤ Robokassa**
–ù—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–æ—á–Ω—ã–π URL –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Robokassa:
- **Success:** `https://shahshop.ru/payment-result?OrderId={OrderId}&InvId={InvId}&SignatureValue={SignatureValue}`
- **Fail:** `https://shahshop.ru/payment-result?OrderId={OrderId}&InvId={InvId}&SignatureValue={SignatureValue}&fail=1`

–°–µ–π—á–∞—Å —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫–∞–∫ `https://shahshop.ru/api/robokassa/result` (–¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞).

### 4. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã –∏ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–≥—Ä—É–∑–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å email —Å –Ω–æ–º–µ—Ä–æ–º –∑–∞–∫–∞–∑–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∞–≤–∫–µ.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–æ–¥–ø–∏—Å—å MD5
–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã MD5-—Ö–µ—à–µ–º:
```
Signature = MD5(MerchantId:Sum:OrderId:Password)
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –ø–ª–∞—Ç–µ–∂–∞.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```bash
node server.js
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Vite:
```bash
npm run dev
```

### 3. –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É (`http://localhost:5173`)
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –ù–∞–∂–∞—Ç—å "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑"
4. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É
5. –ù–∞–∂–∞—Ç—å "–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ"
6. –ë—É–¥–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Robokassa (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–∞—Ä—Ç—ã)

## üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `.env` –µ—Å—Ç—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```
MOYSKLAD_PUBLIC_TOKEN=https://b2b.moysklad.ru/public/Nk4i8a8eOIMa
VITE_MOYSKLAD_TOKEN=1cb0d68d9242028446bd8442c63c5560a1161213
ROBOKASSA_MERCHANT_ID=CofeeShah
ROBOKASSA_PASS1=ZfoI2F5EcLxitlb6pQ19
ROBOKASSA_PASS2=W6APdxswwMX2e8qEVS35
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Robokassa
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.robokassa.ru/
- –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç: https://merchant.robokassa.ru/
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –≤ –∫–∞–±–∏–Ω–µ—Ç–µ
