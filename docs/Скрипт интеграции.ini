Скрипт интеграции
Integration.js — способ интеграции методов оплат в приложения мерчанта.

Скрипт позволяет добавить виджет с кнопками оплаты на сайт и открывать платежную форму в iframe.

Требования к подключению
Требования к вашему сайту, чтобы использовать скрипты интеграции для виджета:

Работает по протоколу HTTPS;

На сайте нет заголовков Cross-Origin-Opener-Policy: *;

Политики CSP на сайте разрешают использование адресов:

 script-src: https://*.tinkoff.ru https://*.tcsbank.ru https://*.tbank.ru https://*.nspk.ru https://*.t-static.ru
 https://*.nspk.ru https://*.t-static.ru
 img-src: https://*.tinkoff.ru https://*.tcsbank.ru https://*.tbank.ru https://*.nspk.ru https://*.t-static.ru
 connect-src: https://*.tinkoff.ru https://*.tcsbank.ru https://*.tbank.ru https://*.nspk.ru https://*.t-static.ru
 style-src: 'unsafe-inline' https://*.tinkoff.ru https://*.tcsbank.ru https://*.tbank.ru https://*.nspk.ru https://*.t-static.ru

Для интеграции кнопок быстрой оплаты можно использовать frame-src:

  frame-src: https://*.tinkoff.ru https://*.tcsbank.ru https://*.tbank.ru

Для интеграции платежной формы в iframe использовать frame-src нельзя — директива нарушит процесс прохождения 3DS и заблокирует оплаты по карте.

Минимальные поддерживаемые версии браузеров:

Chrome — 63;
Edge — 19;
Safari — 12;
Firefox — 67;
Opera — 50;
IE — не поддерживается;
Samsung Internet — 8.2;
Opera Mobile — 73.
Подключение
Не копируйте скрипт в свою сборку полностью — рекомендуем загружать его из предоставленного URL. Это позволит использовать актуальную версию скрипта со всеми исправлениями и обновлениями безопасности.

Установите HTML-код на всех нужных страницах перед закрывающим тегом </body> и в атрибуте onload передайте название метода, который будет отвечать за инициализацию скрипта платежей:
<script src="https://integrationjs.tbank.ru/integration.js" onload="onPaymentIntegrationLoad()" async></script>

Проведите инициализацию скрипта:
<script>
  const initConfig = { // Интерфейс IntegrationInitConfig. Подробное описание в разделе «Интерфейс глобальной конфигурации»
    ...
  }    
  
  function onPaymentIntegrationLoad() {
    PaymentIntegration.init(initConfig).then().catch();
  }
</script>


Альтернативные способы инициализации
Настройте конфигурацию скрипта. Используйте только те ключи объекта features (модули), которые вам нужны.
<script> 
  const initConfig = {
    terminalKey: 'myTerminalKey', // Значение TerminalKey из личного кабинета
    product: 'eacq',
    features: {
       payment: {}, // Добавьте, если нужны кнопки оплаты
       iframe: {} // Добавьте, если нужно встроить платежную форму в iframe
       addcardIframe: {} // Добавьте, если нужно встроить приложение привязки карты в iframe
    }
  }
</script>

Как встроить кнопки оплаты
Как открыть платежную форму в iframe
Конфигурация

Интерфейс глобальной конфигурации
export interface IntegrationInitConfig {
  terminalKey: string;
  product: 'eacq';
  features:  {
    addcardIframe?: {
      container?: HTMLElement | null;
      config?: IframeIntegrationConfig;
      paymentStartCallback?: PaymentStartCallback;
    };
    iframe?: {
      container?: HTMLElement | null;
      config?: IframeIntegrationConfig;
      paymentStartCallback?: PaymentStartCallback;
    };
    payment?: {
      container?: HTMLElement | null;
      config?: PaymentIntegrationConfig;
      paymentStartCallback?: PaymentStartCallback;
    };
  };
}


Параметры глобальной конфигурации
terminalKey — значение terminalKey из личного кабинета.
product — продукт. Значение для интернет-эквайринга — eacq.
features — объект для модулей. При включении параметра в конфигурацию загрузится модуль работы:
addcardIframe — модуль работы с iframe формы привязки карты;
iframe — с iframe;
payment — с виджетами оплаты.
Параметры контейнера:

container — HTMLDivElement для встраивания — например, document.getElementById('paymentContainer'). Контейнер с id="paymentContainer" должен существовать в момент инициализации скрипта. В модулях addcardIframe и iframe — для встраивания формы в iframe, в модуле payment — для встраивания всех доступных терминалу методов оплаты.
config — дает возможность переопределить стандартное поведение скрипта.
paymentStartCallback — возвращает Promise, который резолвит ссылку платежной формы — PaymentUrl.
В этой функции должен вызываться ваш бэкенд-сервис — в него передается внутренний orderId. Бэкенд-сервис находит необходимые для запроса метода «Инициировать платеж» поля (например, сумма) внутри вашей системы и отправляет запрос.

PaymentURL из ответа должен вернуться на фронтенд в paymentStartCallback.
Пример:

const res = await new PaymentIntegration.Helpers().request(URL, 'POST', INIT_PARAMS);
return res.PaymentURL;

Переменная PaymentIntegration содержит класс-помощник Helpers c методом request для отправки запросов на бэкенд. В примере URL — это URL вашего бэкенд-сервиса, который вызовет метод «Инициировать платеж» и вернет PaymentURL.

@param {OverlayType} paymentType // Способ оплаты, выбранный пользователем
@returns {Promise<string>}


Пример конфигурации для кнопок оплаты
<script>
  const initConfig = {
    terminalKey: 'myTerminalKey', // Значение TerminalKey из личного кабинета
    product: 'eacq',
    features: {
      payment: {
        /**
         * Если используется параметр container, скрипт встроит все доступные терминалу методы оплаты в этот элемент
         * На странице должен существовать элемент с id="paymentContainer"
         */
        container: document.getElementById('paymentContainer'),
        /**
         * Функция paymentStartCallback должна возвращать Promise, который резолвит ссылку платежной формы — PaymentURL
         *
         * В этой функции должен вызываться ваш бэкенд-сервис — в него передается внутренний OrderId
         * Бэкенд-сервис находит необходимые для запроса метода «Инициировать платеж» поля (например, сумма) внутри вашей системы и отправляет запрос
         * PaymentURL из ответа должен вернутся на фронтенд в paymentStartCallback
         *
         * Пример:
         * const res = await new PaymentIntegration.Helpers().request(URL, 'POST', INIT_PARAMS);
         * return res.PaymentURL;
         *
         * Переменная PaymentIntegration содержит класс-помощник Helpers c методом request для отправки запросов на бэкенд
         * В примере URL — это URL вашего бэкенд-сервиса, который вызовет метод «Инициировать платеж» и вернет PaymentURL
         *
         * @param {OverlayType} paymentType — способ оплаты, выбранный пользователем
         * @returns {Promise<string>}
         */
        paymentStartCallback: async () => {
          const res = await new PaymentIntegration.Helpers().request(URL, 'POST', INIT_PARAMS); // URL — это URL вашего бэкенда, который вызовет метод «Инициировать платеж»
          return res.PaymentURL;
        },
      },
    },
  };
  function onPaymentIntegrationLoad() {
    PaymentIntegration.init(initConfig).then().catch();
  }
</script>



Пример конфигурации для платежной формы в iframe
<script> 
  const initConfig = {
    terminalKey: 'myTerminalKey', // Значение TerminalKey из личного кабинета
    product: 'eacq',
    features: {
       iframe: { // Добавьте, если нужно встроить платежную форму в iframe
          container: document.getElementById('paymentContainer'), // На странице должен существовать элемент с id="paymentContainer"
          paymentStartCallback: async () => {     
            const res = await integration.helpers.init(URL, 'POST', {}); // URL — это URL вашего бэкенда, который вызовет метод «Инициировать платеж»
            return res.paymentUrl;
          }        
       }
    }
  }
  function onPaymentIntegrationLoad() {
    PaymentIntegration.init(initConfig).then().catch();
  }
</script>